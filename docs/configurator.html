<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üßô Mendix Widget Generator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --primary: #0595db;
      --primary-dark: #0477b2;
      --secondary: #264ae5;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --bg: #0f172a;
      --bg-card: #1e293b;
      --bg-input: #334155;
      --text: #f1f5f9;
      --text-muted: #94a3b8;
      --border: #475569;
      --radius: 12px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }

    header {
      text-align: center;
      margin-bottom: 3rem;
    }

    header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    header h1 span {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    header p {
      color: var(--text-muted);
      font-size: 1.1rem;
    }

    .layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }

    @media (max-width: 1024px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius);
      padding: 1.5rem;
      border: 1px solid var(--border);
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }

    .card-header h2 {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-group label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: var(--text);
    }

    .form-group label span {
      color: var(--danger);
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 0.75rem 1rem;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 0.875rem;
      font-family: inherit;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(5, 149, 219, 0.2);
    }

    input::placeholder,
    textarea::placeholder {
      color: var(--text-muted);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    button {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      font-family: inherit;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(5, 149, 219, 0.4);
    }

    .btn-secondary {
      background: var(--bg-input);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--border);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-small {
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
    }

    .property-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      max-height: 300px;
      overflow-y: auto;
    }

    .property-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem;
      background: var(--bg);
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .property-item .name {
      font-weight: 500;
      flex: 1;
    }

    .property-item .type {
      color: var(--text-muted);
      font-size: 0.75rem;
      background: var(--bg-input);
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
    }

    .code-output {
      background: #0d1117;
      border-radius: 8px;
      padding: 1rem;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      overflow-x: auto;
      white-space: pre;
      color: #e6edf3;
      max-height: 500px;
      overflow-y: auto;
    }

    .tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .tab {
      padding: 0.5rem 1rem;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
    }

    .tab.active {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }

    .actions {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.75);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--bg-card);
      border-radius: var(--radius);
      padding: 1.5rem;
      width: 100%;
      max-width: 500px;
      border: 1px solid var(--border);
      transform: scale(0.95);
      transition: transform 0.3s;
    }

    .modal-overlay.active .modal {
      transform: scale(1);
    }

    .modal h3 {
      margin-bottom: 1.5rem;
      font-size: 1.25rem;
    }

    .templates {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .template-card {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .template-card:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
    }

    .template-card h4 {
      font-size: 0.875rem;
      margin-bottom: 0.25rem;
    }

    .template-card p {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: var(--success);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      font-weight: 500;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>üßô <span>Mendix Widget Generator</span></h1>
      <p>Design your pluggable widget visually, then generate the code</p>
    </header>

    <!-- Quick Start Templates -->
    <section class="templates">
      <div class="template-card" onclick="loadTemplate('status-badge')">
        <h4>üè∑Ô∏è Status Badge</h4>
        <p>Colored indicator with label</p>
      </div>
      <div class="template-card" onclick="loadTemplate('data-card')">
        <h4>üìã Data Card</h4>
        <p>Repeating card layout</p>
      </div>
      <div class="template-card" onclick="loadTemplate('text-input')">
        <h4>üìù Text Input</h4>
        <p>Custom validated input</p>
      </div>
      <div class="template-card" onclick="loadTemplate('progress-bar')">
        <h4>üìä Progress Bar</h4>
        <p>Visual progress indicator</p>
      </div>
      <div class="template-card" onclick="loadTemplate('rating')">
        <h4>‚≠ê Star Rating</h4>
        <p>Interactive rating</p>
      </div>
      <div class="template-card" onclick="loadTemplate('blank')">
        <h4>‚ûï Blank Widget</h4>
        <p>Start from scratch</p>
      </div>
    </section>

    <div class="layout">
      <!-- Left Column: Config Form -->
      <div class="card">
        <div class="card-header">
          <span>‚öôÔ∏è</span>
          <h2>Widget Configuration</h2>
        </div>

        <form id="widgetForm">
          <div class="form-row">
            <div class="form-group">
              <label>Widget Name <span>*</span></label>
              <input type="text" id="widgetName" placeholder="MyWidget" required pattern="[A-Z][a-zA-Z0-9]+">
            </div>
            <div class="form-group">
              <label>Display Name <span>*</span></label>
              <input type="text" id="displayName" placeholder="My Widget">
            </div>
          </div>

          <div class="form-group">
            <label>Description</label>
            <input type="text" id="description" placeholder="What does this widget do?">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Category</label>
              <select id="category">
                <option value="Display">Display</option>
                <option value="Input controls">Input controls</option>
                <option value="Data controls">Data controls</option>
                <option value="Navigation">Navigation</option>
                <option value="File handling">File handling</option>
                <option value="Utilities">Utilities</option>
              </select>
            </div>
            <div class="form-group">
              <label>Platform</label>
              <select id="platform">
                <option value="Web">Web</option>
                <option value="Native">Native (Mobile)</option>
              </select>
            </div>
          </div>

          <!-- Properties Section -->
          <div class="form-group">
            <label>Properties</label>
            <div class="property-list" id="propertyList">
              <!-- Properties will be added here dynamically -->
            </div>
            <button type="button" class="btn-secondary btn-small" style="margin-top: 0.75rem"
              onclick="openPropertyModal()">
              + Add Property
            </button>
          </div>

          <!-- Events Section -->
          <div class="form-group">
            <label>Events</label>
            <div class="property-list" id="eventList">
              <!-- Events will be added here dynamically -->
            </div>
            <button type="button" class="btn-secondary btn-small" style="margin-top: 0.75rem"
              onclick="openEventModal()">
              + Add Event
            </button>
          </div>

          <div class="actions">
            <button type="button" class="btn-primary" onclick="generateConfig()">
              ‚ö° Generate Config
            </button>
            <button type="button" class="btn-secondary" onclick="copyConfig()">
              üìã Copy JSON
            </button>
            <button type="button" class="btn-secondary" onclick="downloadConfig()">
              üíæ Download
            </button>
          </div>
        </form>
      </div>

      <!-- Right Column: Code Output -->
      <div class="card">
        <div class="card-header">
          <span>üìÑ</span>
          <h2>Generated Output</h2>
        </div>

        <div class="tabs">
          <button class="tab active" onclick="showTab('json')">config.json</button>
          <button class="tab" onclick="showTab('xml')">Widget.xml</button>
          <button class="tab" onclick="showTab('command')">Command</button>
        </div>

        <pre class="code-output" id="codeOutput">{
  "name": "MyWidget",
  "displayName": "My Widget",
  "description": "A custom widget",
  "category": "Display",
  "properties": [],
  "events": []
}</pre>
      </div>
    </div>
  </div>

  <!-- Add Property Modal -->
  <div class="modal-overlay" id="propertyModal">
    <div class="modal">
      <h3>Add Property</h3>
      <form id="propertyForm">
        <div class="form-row">
          <div class="form-group">
            <label>Key <span>*</span></label>
            <input type="text" id="propKey" placeholder="myProperty" required>
          </div>
          <div class="form-group">
            <label>Type <span>*</span></label>
            <select id="propType" onchange="updatePropTypeOptions()">
              <option value="string">String</option>
              <option value="boolean">Boolean</option>
              <option value="integer">Integer</option>
              <option value="decimal">Decimal</option>
              <option value="enumeration">Enumeration</option>
              <option value="textTemplate">Text Template</option>
              <option value="expression">Expression</option>
              <option value="attribute">Attribute</option>
              <option value="datasource">Datasource</option>
              <option value="widgets">Widgets (Container)</option>
              <option value="icon">Icon</option>
              <option value="image">Image</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>Caption</label>
          <input type="text" id="propCaption" placeholder="My Property">
        </div>

        <div class="form-group">
          <label>Description</label>
          <input type="text" id="propDescription" placeholder="What this property does">
        </div>

        <div class="form-group" id="enumValuesGroup" style="display: none;">
          <label>Enum Values (comma-separated)</label>
          <input type="text" id="propEnumValues" placeholder="option1, option2, option3">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Default Value</label>
            <input type="text" id="propDefault" placeholder="">
          </div>
          <div class="form-group">
            <label>Required</label>
            <select id="propRequired">
              <option value="false">No</option>
              <option value="true">Yes</option>
            </select>
          </div>
        </div>

        <div class="actions">
          <button type="button" class="btn-primary" onclick="addProperty()">Add Property</button>
          <button type="button" class="btn-secondary" onclick="closeModal('propertyModal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add Event Modal -->
  <div class="modal-overlay" id="eventModal">
    <div class="modal">
      <h3>Add Event</h3>
      <form id="eventForm">
        <div class="form-group">
          <label>Key <span>*</span></label>
          <input type="text" id="eventKey" placeholder="onClick" required>
        </div>

        <div class="form-group">
          <label>Caption</label>
          <input type="text" id="eventCaption" placeholder="On Click">
        </div>

        <div class="form-group">
          <label>Description</label>
          <input type="text" id="eventDescription" placeholder="Triggered when user clicks">
        </div>

        <div class="actions">
          <button type="button" class="btn-primary" onclick="addEvent()">Add Event</button>
          <button type="button" class="btn-secondary" onclick="closeModal('eventModal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast">Copied to clipboard!</div>

  <script>
    // State
    let properties = [];
    let events = [];
    let currentTab = 'json';

    // Templates
    const TEMPLATES = {
      'status-badge': {
        name: 'StatusBadge',
        displayName: 'Status Badge',
        description: 'Displays a colored status indicator with label',
        category: 'Display',
        properties: [
          { key: 'status', type: 'enumeration', caption: 'Status', description: 'Status type', enumValues: ['info', 'success', 'warning', 'error'], defaultValue: 'info' },
          { key: 'label', type: 'textTemplate', caption: 'Label', description: 'Badge text', required: true },
          { key: 'showIcon', type: 'boolean', caption: 'Show Icon', description: 'Display status icon', defaultValue: true }
        ],
        events: [
          { key: 'onClick', caption: 'On Click', description: 'Triggered when badge is clicked' }
        ]
      },
      'data-card': {
        name: 'DataCard',
        displayName: 'Data Card',
        description: 'Card component for datasource items',
        category: 'Data controls',
        properties: [
          { key: 'dataSource', type: 'datasource', caption: 'Data source', description: 'List of items', required: true },
          { key: 'content', type: 'widgets', caption: 'Card Content', description: 'Widget content for each card' },
          { key: 'columns', type: 'enumeration', caption: 'Columns', description: 'Grid columns', enumValues: ['1', '2', '3', '4'], defaultValue: '3' }
        ],
        events: [
          { key: 'onSelect', caption: 'On Select', description: 'Triggered when card is selected' }
        ]
      },
      'text-input': {
        name: 'TextInput',
        displayName: 'Text Input',
        description: 'Custom text input with validation',
        category: 'Input controls',
        properties: [
          { key: 'value', type: 'attribute', caption: 'Value', description: 'Bound attribute', required: true },
          { key: 'placeholder', type: 'string', caption: 'Placeholder', description: 'Placeholder text', defaultValue: 'Enter text...' },
          { key: 'maxLength', type: 'integer', caption: 'Max Length', description: 'Maximum characters', defaultValue: 255 }
        ],
        events: [
          { key: 'onChange', caption: 'On Change', description: 'Triggered when value changes' }
        ]
      },
      'progress-bar': {
        name: 'ProgressBar',
        displayName: 'Progress Bar',
        description: 'Visual progress indicator',
        category: 'Display',
        properties: [
          { key: 'value', type: 'expression', caption: 'Value', description: 'Current value (0-100)', required: true },
          { key: 'showLabel', type: 'boolean', caption: 'Show Label', description: 'Display percentage', defaultValue: true },
          { key: 'color', type: 'enumeration', caption: 'Color', description: 'Bar color', enumValues: ['primary', 'success', 'warning', 'danger'], defaultValue: 'primary' }
        ],
        events: []
      },
      'rating': {
        name: 'Rating',
        displayName: 'Star Rating',
        description: 'Interactive star rating component',
        category: 'Input controls',
        properties: [
          { key: 'value', type: 'attribute', caption: 'Value', description: 'Rating value', required: true },
          { key: 'maxStars', type: 'integer', caption: 'Max Stars', description: 'Number of stars', defaultValue: 5 },
          { key: 'readonly', type: 'boolean', caption: 'Read Only', description: 'Disable interaction', defaultValue: false }
        ],
        events: [
          { key: 'onChange', caption: 'On Change', description: 'Triggered when rating changes' }
        ]
      },
      'blank': {
        name: 'MyWidget',
        displayName: 'My Widget',
        description: 'A custom widget',
        category: 'Display',
        properties: [],
        events: []
      }
    };

    function loadTemplate(templateName) {
      const template = TEMPLATES[templateName];
      if (!template) return;

      document.getElementById('widgetName').value = template.name;
      document.getElementById('displayName').value = template.displayName;
      document.getElementById('description').value = template.description;
      document.getElementById('category').value = template.category;

      properties = [...template.properties];
      events = [...template.events];

      renderProperties();
      renderEvents();
      generateConfig();

      showToast(`Loaded ${template.displayName} template`);
    }

    function renderProperties() {
      const list = document.getElementById('propertyList');
      list.innerHTML = properties.map((p, i) => `
                <div class="property-item">
                    <span class="name">${p.key}</span>
                    <span class="type">${p.type}</span>
                    <button type="button" class="btn-danger btn-small" onclick="removeProperty(${i})">√ó</button>
                </div>
            `).join('');
    }

    function renderEvents() {
      const list = document.getElementById('eventList');
      list.innerHTML = events.map((e, i) => `
                <div class="property-item">
                    <span class="name">${e.key}</span>
                    <span class="type">action</span>
                    <button type="button" class="btn-danger btn-small" onclick="removeEvent(${i})">√ó</button>
                </div>
            `).join('');
    }

    function openPropertyModal() {
      document.getElementById('propertyModal').classList.add('active');
      document.getElementById('propKey').focus();
    }

    function openEventModal() {
      document.getElementById('eventModal').classList.add('active');
      document.getElementById('eventKey').focus();
    }

    function closeModal(id) {
      document.getElementById(id).classList.remove('active');
    }

    function updatePropTypeOptions() {
      const type = document.getElementById('propType').value;
      document.getElementById('enumValuesGroup').style.display =
        type === 'enumeration' ? 'block' : 'none';
    }

    function addProperty() {
      const prop = {
        key: document.getElementById('propKey').value,
        type: document.getElementById('propType').value,
        caption: document.getElementById('propCaption').value,
        description: document.getElementById('propDescription').value,
        required: document.getElementById('propRequired').value === 'true'
      };

      const defaultVal = document.getElementById('propDefault').value;
      if (defaultVal) {
        if (prop.type === 'boolean') {
          prop.defaultValue = defaultVal === 'true';
        } else if (prop.type === 'integer' || prop.type === 'decimal') {
          prop.defaultValue = Number(defaultVal);
        } else {
          prop.defaultValue = defaultVal;
        }
      }

      if (prop.type === 'enumeration') {
        const enumValues = document.getElementById('propEnumValues').value;
        prop.enumValues = enumValues.split(',').map(v => v.trim()).filter(Boolean);
      }

      properties.push(prop);
      renderProperties();
      closeModal('propertyModal');

      // Reset form
      document.getElementById('propertyForm').reset();
      document.getElementById('enumValuesGroup').style.display = 'none';

      generateConfig();
    }

    function addEvent() {
      const event = {
        key: document.getElementById('eventKey').value,
        caption: document.getElementById('eventCaption').value,
        description: document.getElementById('eventDescription').value
      };

      events.push(event);
      renderEvents();
      closeModal('eventModal');
      document.getElementById('eventForm').reset();

      generateConfig();
    }

    function removeProperty(index) {
      properties.splice(index, 1);
      renderProperties();
      generateConfig();
    }

    function removeEvent(index) {
      events.splice(index, 1);
      renderEvents();
      generateConfig();
    }

    function getConfig() {
      return {
        name: document.getElementById('widgetName').value || 'MyWidget',
        displayName: document.getElementById('displayName').value || 'My Widget',
        description: document.getElementById('description').value || 'A custom widget',
        category: document.getElementById('category').value,
        platform: document.getElementById('platform').value,
        properties: properties,
        events: events
      };
    }

    function generateConfig() {
      const config = getConfig();
      updateCodeOutput(config);
    }

    function updateCodeOutput(config) {
      const output = document.getElementById('codeOutput');

      if (currentTab === 'json') {
        output.textContent = JSON.stringify(config, null, 2);
      } else if (currentTab === 'xml') {
        output.textContent = generateWidgetXml(config);
      } else if (currentTab === 'command') {
        output.textContent = generateCommand(config);
      }
    }

    function generateWidgetXml(config) {
      const widgetId = `mycompany.${config.name.toLowerCase()}.${config.name}`;
      let xml = `<?xml version="1.0" encoding="utf-8"?>
<widget id="${widgetId}" pluginWidget="true" needsEntityContext="false"
        supportedPlatform="${config.platform || 'Web'}" offlineCapable="true"
        xmlns="http://www.mendix.com/widget/1.0/">
    <name>${config.displayName}</name>
    <description>${config.description}</description>
    <icon/>
    <properties>
        <propertyGroup caption="General">`;

      // Add properties
      for (const prop of config.properties) {
        xml += `\n            ${generatePropertyXml(prop)}`;
      }

      xml += `
        </propertyGroup>`;

      // Add events
      if (config.events.length > 0) {
        xml += `
        <propertyGroup caption="Events">`;
        for (const event of config.events) {
          xml += `
            <property key="${event.key}" type="action" required="false">
                <caption>${event.caption}</caption>
                <description>${event.description}</description>
            </property>`;
        }
        xml += `
        </propertyGroup>`;
      }

      xml += `
        <propertyGroup caption="Common">
            <systemProperty key="Name" />
            <systemProperty key="Visibility" />
        </propertyGroup>
    </properties>
</widget>`;

      return xml;
    }

    function generatePropertyXml(prop) {
      let attrs = `key="${prop.key}" type="${prop.type}"`;

      if (prop.required) attrs += ` required="true"`;
      if (prop.defaultValue !== undefined && prop.type !== 'enumeration') {
        attrs += ` defaultValue="${prop.defaultValue}"`;
      }

      let inner = `
                <caption>${prop.caption || prop.key}</caption>
                <description>${prop.description || ''}</description>`;

      if (prop.type === 'enumeration' && prop.enumValues) {
        if (prop.defaultValue) attrs += ` defaultValue="${prop.defaultValue}"`;
        inner += `
                <enumerationValues>`;
        for (const val of prop.enumValues) {
          inner += `
                    <enumerationValue key="${val}">${val.charAt(0).toUpperCase() + val.slice(1)}</enumerationValue>`;
        }
        inner += `
                </enumerationValues>`;
      }

      return `<property ${attrs}>${inner}
            </property>`;
    }

    function generateCommand(config) {
      const filename = `${config.name.toLowerCase()}-config.json`;
      return `# Save the JSON config as ${filename}, then run:

npx create-mendix-widget --config ${filename}

# Or use a template:
npx create-mendix-widget --template status-badge

# Or use the interactive wizard:
npx create-mendix-widget ${config.name}`;
    }

    function showTab(tab) {
      currentTab = tab;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      generateConfig();
    }

    function copyConfig() {
      const output = document.getElementById('codeOutput').textContent;
      navigator.clipboard.writeText(output);
      showToast('Copied to clipboard!');
    }

    function downloadConfig() {
      const config = getConfig();
      const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${config.name.toLowerCase()}-config.json`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('Config downloaded!');
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    // Auto-update display name when widget name changes
    document.getElementById('widgetName').addEventListener('input', function (e) {
      const displayName = e.target.value.replace(/([A-Z])/g, ' $1').trim();
      document.getElementById('displayName').value = displayName;
      generateConfig();
    });

    // Auto-generate on any input change
    ['widgetName', 'displayName', 'description', 'category', 'platform'].forEach(id => {
      document.getElementById(id).addEventListener('input', generateConfig);
    });

    // Close modals on escape
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') {
        closeModal('propertyModal');
        closeModal('eventModal');
      }
    });

    // Close modals on overlay click
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', function (e) {
        if (e.target === overlay) {
          overlay.classList.remove('active');
        }
      });
    });

    // Initial generate
    generateConfig();
  </script>
</body>

</html>